{% extends 'base.html' %}
{% load i18n static %}

{% block title %}{% trans 'Submit Work' %} - {{ block.super }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'audio/audio-contribution.css' %}">
{% endblock %}

{% block content %}
<div class="title-with-audio" style="display: flex; align-items: center; gap: 0.125rem; flex-wrap: wrap;">
    <h1 style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
        <span>{% trans 'Submit Work for' %}: {{ job.title }}</span>
        {% load audio_tags %}
        {% audio_player job "title" %}
    </h1>
</div>

<div class="card">
    <p><strong>{% trans 'Target Language' %}:</strong> {{ job.target_language }}</p>
    <p><strong>{% trans 'Budget' %}:</strong> {{ job.budget }} pesos</p>
    <p><strong>{% trans 'Required Deliverables' %}:</strong> {{ job.get_deliverable_types_display }}</p>
</div>

{% if job.has_reference_media %}
    <div class="card">
        {% load audio_tags %}
        {% include 'components/static_title_with_audio.html' with title_text="Reference Media From Funder" slug="section_reference_media_submit" heading_tag="h2" %}
        <p class="muted-text">{% trans 'Review these examples before submitting your work.' %}</p>
        {% if job.reference_audio %}
            <div style="margin-bottom: 1rem;">
                <p style="margin-bottom: 0.25rem;"><strong>{% trans 'Audio instructions' %}</strong></p>
                <audio controls src="{{ job.reference_audio.url }}" style="width: 100%;">
                    {% trans 'Your browser does not support the audio element.' %}
                </audio>
            </div>
        {% endif %}
        {% if job.reference_video %}
            <div style="margin-bottom: 1rem;">
                <p style="margin-bottom: 0.25rem;"><strong>{% trans 'Video reference' %}</strong></p>
                <video controls src="{{ job.reference_video.url }}" style="width: 100%; max-height: 360px;">
                    {% trans 'Your browser does not support the video element.' %}
                </video>
            </div>
        {% endif %}
        {% if job.reference_image %}
            <div>
                <p style="margin-bottom: 0.25rem;"><strong>{% trans 'Image reference' %}</strong></p>
                <img src="{{ job.reference_image.url }}" alt="{% trans 'Reference image for this job' %}" style="max-width: 100%; border-radius: 0.5rem;">
            </div>
        {% endif %}
    </div>
{% endif %}

<div class="card">
    <form method="post" enctype="multipart/form-data" id="job-submission-form">
        {% csrf_token %}
        
        <div class="form-group">
            {% include 'components/form_label_with_audio.html' with label_text="Note" slug="form_note" field_id="note" %}
            <textarea id="note" name="note" rows="4" placeholder="{% trans 'Additional information about your submission...' %}"></textarea>
        </div>
        
        {% for deliverable_type in job.get_deliverable_types_list %}
            <div class="form-group">
                {% if deliverable_type == 'text' %}
                    {% include 'components/form_label_with_audio.html' with label_text="Text File" slug="form_text_file" field_id="text_file" %}
                    <input type="file" id="text_file" name="text_file" accept=".txt,.doc,.docx,.pdf">
                    <p class="muted-text" style="font-size: 0.875rem; margin-top: 0.5rem; margin-bottom: 0.5rem;">
                        {% trans 'Or enter text directly:' %}
                    </p>
                    {% include 'components/form_label_with_audio.html' with label_text="Text Content" slug="form_text_content" field_id="text_content" %}
                    <textarea id="text_content" name="text_content" rows="6" placeholder="{% trans 'Enter your text content here...' %}"></textarea>
                {% elif deliverable_type == 'video' %}
                    {% include 'components/form_label_with_audio.html' with label_text="Video File" slug="form_video_file" field_id="video_file" %}
                    <input type="file" id="video_file" name="video_file" accept="video/*" capture="environment">
                    <p class="muted-text" style="font-size: 0.875rem; margin-top: 0.5rem;">
                        {% trans 'Record with your camera or upload an existing video.' %}
                    </p>
                {% elif deliverable_type == 'audio' %}
                    {% include 'components/form_label_with_audio.html' with label_text="Audio File" slug="form_audio_file" field_id="audio_file" %}
                    <div class="audio-recording-section" data-audio-recording data-file-input-id="audio_file">
                        <div class="recording-controls">
                            <button type="button" class="btn-record" id="btn-start-recording-audio" aria-label="{% trans 'Start recording' %}">
                                <span class="record-icon" aria-hidden="true">??</span>
                                <span class="record-label">{% trans 'Record Audio' %}</span>
                            </button>
                            <button type="button" class="btn-retry" id="btn-retry-recording-audio" style="display: none;" aria-label="{% trans 'Record again' %}">
                                <span class="retry-icon" aria-hidden="true">??</span>
                                <span class="retry-label">{% trans 'Record Again' %}</span>
                            </button>
                            <button type="button" class="btn-stop" id="btn-stop-recording-audio" style="display: none;" aria-label="{% trans 'Stop recording' %}">
                                <span class="stop-icon" aria-hidden="true">?</span>
                                <span class="stop-label">{% trans 'Stop' %}</span>
                            </button>
                            <button type="button" class="btn-cancel" id="btn-cancel-recording-audio" style="display: none;" aria-label="{% trans 'Cancel recording' %}">
                                <span class="cancel-icon" aria-hidden="true">?</span>
                                <span class="cancel-label">{% trans 'Cancel' %}</span>
                            </button>
                        </div>
                        <div class="recording-status" id="recording-status-audio" style="display: none;" role="status" aria-live="polite">
                            <span class="recording-indicator" aria-hidden="true">??</span>
                            <span class="recording-time" id="recording-time-audio">0:00</span>
                        </div>
                        <div class="recording-preview" id="recording-preview-audio" style="display: none;">
                            <audio controls id="recording-audio-preview-audio"></audio>
                        </div>
                    </div>
                    <p class="muted-text" style="font-size: 0.875rem; margin-top: 0.5rem;">
                        {% trans 'Or upload an audio file:' %}
                    </p>
                    <input type="file" id="audio_file" name="audio_file" accept="audio/*">
                {% elif deliverable_type == 'image' %}
                    {% include 'components/form_label_with_audio.html' with label_text="Image File" slug="form_image_file" field_id="image_file" %}
                    <input type="file" id="image_file" name="image_file" accept="image/*" capture="environment">
                    <p class="muted-text" style="font-size: 0.875rem; margin-top: 0.5rem;">
                        {% trans 'Take a quick photo or upload an existing image.' %}
                    </p>
                {% endif %}
            </div>
        {% endfor %}
        
        <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
            <button type="submit" class="btn btn-primary">{% trans 'Submit' %}</button>
            {% audio_player_static_ui "button_submit" "label" %}
            <a href="{% url 'jobs:detail' job.pk %}" class="btn">{% trans 'Cancel' %}</a>
            {% audio_player_static_ui "button_cancel" "label" %}
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'audio/audio-recorder.js' %}"></script>
<script src="{% static 'jobs/job-submission-audio.js' %}"></script>
{% endblock %}
