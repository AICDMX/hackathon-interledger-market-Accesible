{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans 'Browse Jobs' %} - {{ block.super }}{% endblock %}

{% block extra_css %}
<style>
    .filter-options {
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 1rem;
        margin: 0;
    }
    
    .filter-options legend {
        font-weight: 600;
        padding: 0 0.5rem;
        margin-bottom: 0.5rem;
    }
    
    .checkbox-group {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }
    
    .checkbox-group label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: normal;
        margin-bottom: 0;
        cursor: pointer;
    }
    
    .checkbox-group input[type="checkbox"] {
        width: auto;
        margin: 0;
        cursor: pointer;
        flex-shrink: 0;
    }
</style>
{% endblock %}

{% block content %}
<h1>{% trans 'Available Jobs' %}</h1>

{% if user.is_authenticated and waiting_for_submission %}
    <div class="card" style="border-left: 4px solid #f59e0b; margin-bottom: 1.5rem;">
        <h2 style="margin-top: 0; color: #b45309;">{% trans 'Jobs Waiting for Your Submission' %}</h2>
        <p>{% trans 'You\'ve been selected for these jobs. Submit your work now!' %}</p>
        <div role="list" aria-label="{% trans 'Jobs waiting for submission' %}">
            {% for job in waiting_for_submission %}
                <article class="card" role="listitem" style="margin-top: 1rem;">
                    <h3><a href="{% url 'jobs:detail' job.pk %}">{{ job.title }}</a></h3>
                    <p><strong>{% trans 'Language' %}:</strong> {{ job.target_language }}</p>
                    <p><strong>{% trans 'Amount Per Person' %}:</strong> {{ job.amount_per_person }} ILP</p>
                    <p>{{ job.description|truncatewords:30 }}</p>
                    <a href="{% url 'jobs:submit' job.pk %}" class="btn btn-primary">{% trans 'Submit Work Now' %}</a>
                </article>
            {% endfor %}
        </div>
    </div>
{% endif %}

<div class="card">
    <form method="get" action="{% url 'jobs:list' %}" role="search">
        <div class="form-group">
            <label for="search">{% trans 'Search Jobs' %}</label>
            <input type="text" id="search" name="search" value="{{ search_query }}" placeholder="{% trans 'Search by title or description...' %}">
        </div>
        <div class="form-group">
            <label for="language">{% trans 'Filter by Language' %}</label>
            <select id="language" name="language">
                <option value="">{% trans 'All Languages' %}</option>
                <option value="en" {% if language_filter == 'en' %}selected{% endif %}>English</option>
                <option value="es" {% if language_filter == 'es' %}selected{% endif %}>Spanish</option>
                <option value="nah" {% if language_filter == 'nah' %}selected{% endif %}>Nahuatl</option>
                <option value="oto" {% if language_filter == 'oto' %}selected{% endif %}>Otomi</option>
                <option value="maz" {% if language_filter == 'maz' %}selected{% endif %}>Mazahua</option>
                <option value="que" {% if language_filter == 'que' %}selected{% endif %}>Quechua</option>
            </select>
        </div>
        {% if user.is_authenticated %}
        <div class="form-group">
            <fieldset class="filter-options">
                <legend>{% trans 'Filter Options' %}</legend>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" name="hide_applied" {% if hide_applied %}checked{% endif %}>
                        {% trans 'Hide jobs I\'ve applied to' %}
                    </label>
                </div>
            </fieldset>
        </div>
        {% endif %}
        <button type="submit" class="btn btn-primary">{% trans 'Filter' %}</button>
    </form>
</div>

{% if jobs %}
    <div role="list" aria-label="{% trans 'Job listings' %}">
        {% for job in jobs %}
            <article class="card" role="listitem">
                <h2><a href="{% url 'jobs:detail' job.pk %}">{{ job.title }}</a></h2>
                <p><strong>{% trans 'Language' %}:</strong> {{ job.target_language }}</p>
                {% if job.target_dialect %}
                    <p><strong>{% trans 'Dialect' %}:</strong> {{ job.target_dialect }}</p>
                {% endif %}
                <p><strong>{% trans 'Amount Per Person' %}:</strong> {{ job.amount_per_person }} ILP</p>
                <p><strong>{% trans 'Total Budget' %}:</strong> {{ job.budget }} ILP</p>
                <p><strong>{% trans 'Status' %}:</strong> {{ job.get_status_display }}</p>
                <p><strong>{% trans 'Deliverables' %}:</strong> {{ job.get_deliverable_types_display }}</p>
                <p>{{ job.description|truncatewords:30 }}</p>
                <a href="{% url 'jobs:detail' job.pk %}" class="btn btn-primary">{% trans 'View Details' %}</a>
            </article>
        {% endfor %}
    </div>
{% else %}
    <div class="card">
        <p>{% trans 'No jobs available at the moment.' %}</p>
    </div>
{% endif %}
{% endblock %}
